<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    {% block title %}À table!{% endblock %}
  </title>

  {# CSS global (header, footer…) #}
  <link rel="stylesheet" href="{{ asset('styles/base.css') }}">
  {% block stylesheets %}{% endblock %}
</head>

<body>
  <div class="page-wrapper"> {# ✅ Ajouté pour gérer le footer sticky #}

    {% set route = app.request.attributes.get('_route') %}
    {% set isAuthRoute = route in ['app_login', 'app_register'] %}

    {# ---------- HEADER ---------- #}
    <header class="site-header">
      <div class="logo-area">
        <a href="{{ path('app_home') }}" class="logo-link">
          <img src="{{ asset('images/Logo1.png') }}" alt="Logo À table" class="site-logo">
        </a>
      </div>

      <button class="burger" id="burgerBtn" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>

      {% if route not in ['app_login', 'app_register'] %}
      <form action="{{ path('app_search') }}" method="get" class="search-form">
        <input type="text" name="query" placeholder="Rechercher une recette..." value="{{ app.request.get('query') }}">
        <button type="submit" class="search-btn" aria-label="Rechercher">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path
              d="M10 2a8 8 0 015.293 13.707l4.5 4.5a1 1 0 01-1.414 1.414l-4.5-4.5A8 8 0 1110 2zm0 2a6 6 0 100 12A6 6 0 0010 4z" />
          </svg>
        </button>
      </form>
      {% endif %}

      <nav class="user-area {{ isAuthRoute ? 'is-hidden' : '' }}" id="navMenu">

        {% if app.user %}
        <span>
          Bienvenue
          <a href="{{ path('app_profile') }}" class="profile-link">
            <strong>{{ app.user.username ?: app.user.email }}</strong>
          </a>
        </span>

        {% if is_granted('ROLE_ADMIN') %}
        <a href="{{ path('app_admin_dashboard') }}" class="admin-link">Espace Admin</a>
        {% endif %}


        <a href="{{ path('app_logout') }}">Déconnexion</a>

        {% else %}
        <a href="{{ path('app_login') }}">Connexion</a>
        <a href="{{ path('app_register') }}">Inscription</a>
        {% endif %}

      </nav>
    </header>

    <main class="site-main">

      {% for label, messages in app.flashes %}
      {% for m in messages %}
      <div class="flash-{{ label }}">{{ m }}</div>
      {% endfor %}
      {% endfor %}

      {% block body %}{% endblock %}
    </main>

    <footer class="site-footer">
      <p>
        © {{ "now"|date("Y") }} À table ! — Tous droits réservés.
      </p>
    </footer>

  </div> {# ✅ fin du wrapper #}

  <script defer src="{{ asset('scripts/menu.js') }}"></script>
  <script defer src="{{ asset('scripts/filter.js') }}"></script>

</body>

</html>